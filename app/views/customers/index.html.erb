<fieldset>
    <legend>Customers</legend>

    <%= link_to 'Add a new customer', new_customer_path, :class => "add_link", :style => "margin-bottom: 20px" %>

    <% if @customers.empty? == false %>
        <table class="margin_above">
        <% @customers.each do |customer| %>
            <% name = customer.last_name + ", " + customer.first_name %>
            <% if customer.active == 0 %>
                <td><%= link_to name, customer %> (Inactive)</td>
            <% else %>
                <td><%= link_to name, customer %></td>
            <% end %>
            <% if customer.horses.nil? %>
                <td>No horses</td>
            <% else %>
                <% if customer.horses.count() == 0 %>
                    <td>No horses</td>
                <% elsif customer.horses.count() == 1 %>
                    <td><%= customer.horses.first.barn_name %></td>
                <% else %>
                    <% horses = ""
                       customer.horses.each do |horse|
                        horses += horse.barn_name + ", "
                       end
                       horses = horses[0..-3] %>
                    <td><%= horses %></td>
                <% end %>
            <% end %>
            <td></td>
            <td><%= customer.city %>, <%= customer.state %> <%= customer.zip %></td>
            <td><%= link_to 'Add invoice', new_invoice_path(:customer => customer.id) %></td>
            <td><%= link_to 'Edit', edit_customer_path(customer) %></td>
            <td><a href="#" onclick="confirm('Deleting this customer will also permanently delete all of their associated invoice and horse records. Are you sure you want to delete this customer?', '<%= customer_delete_url(customer.id) %>')">Remove</a></td>
          </tr>
        <% end %>
        </table>
    <% else %>
        <p style="margin-top: 15px">You do not have any customers created.</p>
    <% end %>
</fieldset>