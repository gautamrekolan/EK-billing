<div class="breadcrumb">
  <<
  <%= link_to "CUSTOMERS", customers_path %>
</div>

<fieldset>
    <legend>Customer Information</legend>
    <p id="notice"><%= notice %></p>

  <div class="field">
    <label>Name</label>
    <%= @customer.first_name %> <%= @customer.last_name %>
  </div>

  <div class="field">
    <label>Contact information</label>
    <%= @customer.address %>
    <br />
    <label>&nbsp;</label>
    <%= @customer.city %>, <%= @customer.state %> <%= @customer.zip %>
    <br />
    <label>&nbsp;</label>
    <%= number_to_phone(@customer.phone, :area_code => true) %>
    <br />
    <label>&nbsp;</label>
    <% if @customer.email.blank? == false %>
        <a href="mailto:<%= @customer.email %>"><%= @customer.email %></a>
    <% else %>
        No email available.
    <% end %>
  </div>

  <div class="field">
    <label>Invoice delivery</label>
    <%= @customer.delivery_method %>
  </div>

  <div class="field" style="padding-bottom: 15px">
    <label>Active customer</label>
    <% if @customer.active == 1 %>
        Yes
    <% else %>
        No
    <% end %>
  </div>

    <%= link_to 'Edit details', edit_customer_path(@customer), :class => 'link_button' %>
    <a href="#" class="link_button" onclick="confirm('Deleting this customer will also permanently delete all of their associated invoice and horse records. Are you sure you want to delete this customer?', '<%= customer_delete_url(@customer.id) %>')">Remove customer</a>

    <fieldset style="margin-top: 20px; margin-bottom: 20px">
    <legend>Horses</legend>
    <p class="add_link"><%= link_to 'Add a new horse', new_horse_path(:customer => @customer.id) %></p>
    <% if @customer.horses.nil? == false %>
          <table>
          <% @customer.horses.each do |horse| %>
              <tr>
                <% String name = horse.barn_name
                   if horse.reg_name.empty? == false
                        name += " (" + horse.reg_name + ")"
                   end
                %>
                <td style="width: 225px"><%= link_to name, horse_path(horse) %></td>
                <td><%= link_to 'Edit', edit_horse_path(horse) %></td>
                <td><a href="#" onclick="confirm('Are you sure you want to delete this horse?', '<%= horse_delete_url(horse.id) %>')">Remove</a></td>
              </tr>
                <% if horse.notes.blank? == false %>
                <tr>
                  <td style="font-size: 12px; font-style: italic; padding-left: 5px"><%= horse.notes%></td>
                </tr>
              <% end %>
          <% end %>
          </table>
        <% else %>
             <p>This customer currently does not have any horses.</p>
        <% end %>
    </fieldset>

    <fieldset style="margin-bottom: 20px">
    <legend>Invoices</legend>
    <p class="add_link"><%= link_to 'Add a new invoice', new_invoice_path(:customer => @customer.id) %></p>
    <% if @customer.invoices.nil? == false %>
        <table>
            <% @customer.invoices.each do |invoice| %>
            <tr>
                <td><%= link_to invoice.name, invoice %></td>
                <td>Due on <%= invoice.due_date.strftime("%b %e, %Y") %></td>
                <td><%= invoice.status %></td>
                <td><%= link_to 'Edit details', edit_invoice_path(invoice) %></td>
                <td><a href="#" onclick="confirm('Are you sure you want to delete this invoice?', '<%= invoice_delete_url(invoice.id) %>')">Remove</a></td>
                <td><%= link_to 'Add new item', new_item_path(:invoice => invoice) %></td>
            </tr>
            <% end %>
        </table>
    <% end %>
    </fieldset>

    <fieldset style="margin-bottom: 20px">
    <legend>Automatic items</legend>
      <p class="notes">
        Add items to this list that will be added to the majority of this customer's invoices.
        <br />
        You will have the ability to add all of these items to an invoice at once, saving time.
      </p>
      <p class="add_link"><%= link_to 'Add a new auto item', new_auto_path(:customer => @customer.id) %></p>
      <% if @customer.autos.nil? == false %>
        <table>
            <% @customer.autos.each do |auto| %>
                <tr>
                    <td><%= auto.category.category %></td>
                    <td><%= auto.description %></td>
                    <% if auto.horse.nil? == false %>
                        <td><%= auto.horse.barn_name %></td>
                    <% end %>
                    <td><%= auto.quantity %> x <%= number_to_currency(auto.amount) %></td>
                    <% if auto.end_date.blank? == false %>
                        <td>Expires on <%= auto.end_date.strftime("%b %e, %Y") %></td>
                    <% else %>
                        <td>Ongoing</td>
                    <% end %>
                    <td><%= link_to 'Edit', edit_auto_path(auto) %></td>
                    <td><a href="#" onclick="confirm('Are you sure you want to delete this item?', '<%= auto_delete_url(auto.id) %>')">Cancel</a></td>
                </tr>
            <% end %>
        </table>
      <% end %>
    </fieldset>

  <fieldset>
    <legend>Documents</legend>
    <p class="notes">Upload copies of Coggins, registration papers, membership information and more for customers and/or their horses, so you always have them on hand.</p>
    <p class="add_link"><%= link_to 'Add a new document', new_document_path(:customer => @customer.id) %></p>
    <% if @customer.documents.nil? == false %>
        <table>
            <% @customer.documents.each do |document| %>
                <tr>
                    <td><%= link_to document.description, document_path(document) %></td>
                    <% if document.horse.nil? == false %>
                        <td><%= document.horse.barn_name %></td>
                    <% else %>
                        <td>&nbsp;</td>
                    <% end %>
                </tr>
            <% end %>
        </table>
    <% end %>
  </fieldset>
</fieldset>